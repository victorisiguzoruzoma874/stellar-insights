# =============================================================================
# STELLAR INSIGHTS BACKEND - ENVIRONMENT CONFIGURATION
# =============================================================================
# Copy this file to .env and update with your actual values
# NEVER commit .env to version control!
# =============================================================================

# Database Configuration
# For SQLite (recommended for development):
DATABASE_URL=sqlite:./stellar_insights.db
# For PostgreSQL (production):
# DATABASE_URL=postgresql://username:password@localhost:5432/stellar_insights

# Logging
RUST_LOG=info
LOG_FORMAT=json

# Encryption Configuration
# Must be a 32-byte (64-character hex) key for AES-256-GCM
# Generate with: openssl rand -hex 32
ENCRYPTION_KEY=0000000000000000000000000000000000000000000000000000000000000000

# Observability (OpenTelemetry)
OTEL_ENABLED=false
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317

# JWT Secret (REQUIRED)
# Must be at least 32 characters. Generate with: openssl rand -base64 48
JWT_SECRET=CHANGE_ME_generate_with_openssl_rand_base64_48

# Server Configuration
SERVER_HOST=127.0.0.1
SERVER_PORT=8080

# Redis Configuration
REDIS_URL=redis://127.0.0.1:6379

# RPC Configuration
RPC_MOCK_MODE=false
# Retry and circuit breaker (optional; defaults shown)
# RPC_MAX_RETRIES=3
# RPC_INITIAL_BACKOFF_MS=100
# RPC_MAX_BACKOFF_MS=5000
# RPC_CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
# RPC_CIRCUIT_BREAKER_SUCCESS_THRESHOLD=2
# RPC_CIRCUIT_BREAKER_TIMEOUT_SECONDS=30

# RPC Pagination Configuration
# Maximum records to fetch per request (Horizon API limit)
RPC_MAX_RECORDS_PER_REQUEST=200
# Maximum total records to fetch across all paginated requests
RPC_MAX_TOTAL_RECORDS=10000
# Delay between pagination requests in milliseconds (rate limiting)
RPC_PAGINATION_DELAY_MS=100

# Database Connection Pool Configuration
DB_POOL_MAX_CONNECTIONS=10
DB_POOL_MIN_CONNECTIONS=2
DB_POOL_CONNECT_TIMEOUT_SECONDS=30
DB_POOL_IDLE_TIMEOUT_SECONDS=600
DB_POOL_MAX_LIFETIME_SECONDS=1800

# Network Configuration (mainnet/testnet)
STELLAR_NETWORK=mainnet
STELLAR_RPC_URL_MAINNET=https://stellar.api.onfinality.io/public
STELLAR_HORIZON_URL_MAINNET=https://horizon.stellar.org
STELLAR_RPC_URL_TESTNET=https://soroban-testnet.stellar.org
STELLAR_HORIZON_URL_TESTNET=https://horizon-testnet.stellar.org

# Outbound Stellar RPC/Horizon Rate Limiting
# Keep below Horizon's ~100 req/min public default to leave headroom
RPC_RATE_LIMIT_REQUESTS_PER_MINUTE=90
RPC_RATE_LIMIT_BURST_SIZE=10
RPC_RATE_LIMIT_QUEUE_SIZE=100

BACKUP_S3_BUCKET=your-backup-bucket-name
BACKUP_RETENTION_DAYS=30
NOTIFICATION_EMAIL=admin@example.com
WALG_S3_PREFIX=s3://$BACKUP_S3_BUCKET/backups/
PGDATA=/var/lib/postgresql/data
# Backup Configuration (Optional - for production)
# BACKUP_S3_BUCKET=your-backup-bucket-name
# BACKUP_RETENTION_DAYS=30
# NOTIFICATION_EMAIL=admin@example.com
# WALG_S3_PREFIX=s3://your-backup-bucket-name/backups/
# PGDATA=/var/lib/postgresql/data

# Price Feed Configuration
PRICE_FEED_PROVIDER=coingecko
# PRICE_FEED_API_KEY=your_api_key_here
PRICE_FEED_CACHE_TTL_SECONDS=900
PRICE_FEED_REQUEST_TIMEOUT_SECONDS=10

# Compression Configuration
# Minimum response size in bytes to trigger compression (default: 1024)
# Responses smaller than this will not be compressed to avoid overhead
COMPRESSION_MIN_SIZE=1024

# ---------------------------------------------------------------------------
# CORS Configuration
# ---------------------------------------------------------------------------
# Comma-separated list of origins allowed to make cross-origin requests.
#
# Development: allow local frontend dev servers
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3001
#
# Production: restrict to your actual deployed frontend domain(s)
# CORS_ALLOWED_ORIGINS=https://stellar-insights.com,https://www.stellar-insights.com
#
# WARNING: Setting this to "*" allows ALL origins and is NOT safe for production.
# CORS_ALLOWED_ORIGINS=*

# ---------------------------------------------------------------------------
# SEP-10 Authentication Configuration
# ---------------------------------------------------------------------------
# SEP-10 Authentication Configuration (REQUIRED)
# ---------------------------------------------------------------------------
# SECURITY CRITICAL: SEP-10 server public key for Stellar authentication
# This MUST be set to a valid Stellar public key - the placeholder will be rejected
# 
# Generate a new keypair:
#   stellar keys generate --network testnet
#   stellar keys generate --network mainnet
#
# NEVER use the placeholder value in production!
# Format: Must start with 'G' and be exactly 56 characters
SEP10_SERVER_PUBLIC_KEY=GXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

# Home domain for SEP-10 authentication
# This should match your application's domain
SEP10_HOME_DOMAIN=stellar-insights.local

# Stellar network passphrase (must match your network)
# Testnet: "Test SDF Network ; September 2015"
# Mainnet: "Public Global Stellar Network ; September 2015"
STELLAR_NETWORK_PASSPHRASE=Test SDF Network ; September 2015

# ---------------------------------------------------------------------------
# Background Job Configuration
# ---------------------------------------------------------------------------
# Enable/disable individual jobs and configure their intervals

# Corridor refresh job (default: 300 seconds = 5 minutes)
JOB_CORRIDOR_REFRESH_ENABLED=true
JOB_CORRIDOR_REFRESH_INTERVAL_SECONDS=300

# Anchor refresh job (default: 600 seconds = 10 minutes)
JOB_ANCHOR_REFRESH_ENABLED=true
JOB_ANCHOR_REFRESH_INTERVAL_SECONDS=600

# Price feed update job (default: 900 seconds = 15 minutes)
JOB_PRICE_FEED_UPDATE_ENABLED=true
JOB_PRICE_FEED_UPDATE_INTERVAL_SECONDS=900

# Cache cleanup job (default: 3600 seconds = 1 hour)
JOB_CACHE_CLEANUP_ENABLED=true
JOB_CACHE_CLEANUP_INTERVAL_SECONDS=3600
# ---------------------------------------------------------------------------
# Telegram Bot Configuration
# ---------------------------------------------------------------------------
# Bot token from @BotFather. When set, the Telegram notification bot is enabled.
# TELEGRAM_BOT_TOKEN=123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11

# ---------------------------------------------------------------------------
# Admin IP Whitelisting Configuration
# ---------------------------------------------------------------------------
# Comma-separated list of IP addresses and CIDR ranges allowed to access admin endpoints
# Examples:
#   Single IP: 192.168.1.100
#   CIDR range: 192.168.1.0/24
#   Multiple: 192.168.1.100,10.0.0.0/8,172.16.0.1
#   IPv6: ::1,2001:db8::/32
# Development (localhost only):
ADMIN_IP_WHITELIST=127.0.0.1,::1
# Production example:
# ADMIN_IP_WHITELIST=203.0.113.0/24,198.51.100.50

# Trust X-Forwarded-For header when behind proxy/load balancer
# Set to true in production when using a reverse proxy (nginx, ALB, etc.)
ADMIN_IP_TRUST_PROXY=false

# Maximum number of IPs to check in X-Forwarded-For chain (prevents header injection)
# Default: 3
ADMIN_IP_MAX_FORWARDED=3
